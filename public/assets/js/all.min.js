class ChatEngine{constructor(e,t){this.chatBox=$("#"+e),this.userEmail=t,this.socket=io.connect("http://localhost:5000"),this.userEmail&&this.connectionHandler()}connectionHandler(){let s=this;this.socket.on("connect",function(){console.log("connection established using sockets...!"),s.socket.emit("join_room",{user_email:s.userEmail,chatroom:"codeial"}),s.socket.on("user_joined",function(e){console.log("a user joined!",e)})}),$("#send-message").click(function(){var e=$("#chat-message-input").val();""!=e&&s.socket.emit("send_message",{message:e,user_email:s.userEmail,chatroom:"codeial"})}),s.socket.on("receive_message",function(e){console.log("message received",e.message);var t=$("<li>");let o="other-message";e.user_email==s.userEmail&&(o="self-message"),t.append($("<span>",{html:e.message})),t.append($("<sub>",{html:e.user_email})),t.addClass(o),$("#chat-messages-list").append(t)})}}{let e=function(){let t=$("#post-form");t.submit(function(e){e.preventDefault(),$.ajax({type:"post",url:"/posts/addPost",data:t.serialize(),success:function(e){var t=o(e.data.post);$("#post-list-container>ul").prepend(t),s($(" .delete-post-button",t)),new PostComments(e.data.post._id),new Noty({theme:"relax",text:"Post published!",type:"success",layout:"topRight",timeout:1500}).show()},error:function(e){console.log(e.responseText)}})})},o=function(e){return $(`<li id="post-${e._id}">
  <p>
      <small>
              <a class="delete-post-button" href="/posts/destroy/${e._id}">X</a>
      </small>
      ${e.content}
      <br>
      <small>
      ${e.user.name}
      </small>
  </p>
  <div class="post-comments">
          <form action="/comments/addcomment" method="POST">
          <input type="text" name="content" placeholder="type here to add comment">
          <input type="hidden"name=post value="${e._id}">
          <input type="submit" value="Add Comment">
          </form>  
      <div class="post-comments-list">
      <ul id="post-comments-${e._id}">
      </ul>
     </div>
  </div>
  
</li>`)},s=function(t){$(t).click(function(e){e.preventDefault(),$.ajax({type:"get",url:$(t).prop("href"),success:function(e){$("#post-"+e.post_id).remove(),new Noty({theme:"relax",text:"Post Deleted",type:"success",layout:"topRight",timeout:1500}).show()},error:function(e){console.log(e.responseText)}})})},t=function(){$("#post-list-container>ul>li").each(function(){var e=$(this),t=$(" .delete-post-button",e),t=(s(t),e.prop("id").split("-")[1]);new PostComments(t)})};e(),t()}class PostComments{constructor(e){this.postId=e,this.postContainer=$("#post-"+e),this.newCommentForm=$(`#post-${e}-comments-form`),this.createComment(e);let t=this;$(" .delete-comment-button",this.postContainer).each(function(){t.deleteComment($(this))})}createComment(t){let o=this;this.newCommentForm.submit(function(e){e.preventDefault();$.ajax({type:"post",url:"/comments/addcomment",data:$(this).serialize(),success:function(e){e=o.newCommentDom(e.comment);$("#post-comments-"+t).prepend(e),o.deleteComment($(" .delete-comment-button",e)),new Noty({theme:"relax",text:"Comment published!",type:"success",layout:"topRight",timeout:1500}).show()},error:function(e){console.log(e.responseText)}})})}newCommentDom(e){return $(`<li id="comment-${e._id}">
                        <p>
                            
                            <small>
                                <a class="delete-comment-button" href="/comments/destroy/${e._id}">X</a>
                            </small>
                            
                            ${e.content}
                            <br>
                            <small>
                                ${e.user.name}
                            </small>
                        </p>    

                </li>`)}deleteComment(t){$(t).click(function(e){e.preventDefault(),$.ajax({type:"get",url:$(t).prop("href"),success:function(e){$("#comment-"+e.comment_id).remove(),new Noty({theme:"relax",text:"Comment Deleted",type:"success",layout:"topRight",timeout:1500}).show()},error:function(e){console.log(e.responseText)}})})}}function toggleFriend(t){console.log(t),console.log($(t)),$(t).click(function(e){e.preventDefault(),$.ajax({type:"GET",url:$(t).attr("href"),success:function(e){console.log(e.deleted),e.deleted?$(t).html("Add Friend"):$(t).html("Remove Friend")},error:function(e){console.log(e.responseText)}})})}console.log("hiii"),toggleFriend($(".toggle-friend-btn"));class ToggleLike{constructor(e){this.toggler=e,this.toggleLike()}toggleLike(){$(this.toggler).click(function(e){e.preventDefault();let o=this;$.ajax({type:"POST",url:$(o).attr("href")}).done(function(e){let t=parseInt($(o).attr("data-likes"));console.log(t),1==e.data.deleted?--t:t+=1,$(o).attr("data-likes",t),$(o).html(t+" Likes")}).fail(function(e){console.log("error in completing the request")})})}}let preview=function(){$("#change-avtar").change(function(){var e=new FileReader,t=event.target.files[0];e.readAsDataURL(t),e.addEventListener("load",function(){$("#img").attr("src",this.result),console.log(this,this.result)})})};preview();